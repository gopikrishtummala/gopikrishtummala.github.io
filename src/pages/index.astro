---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Socials from "@/components/Socials.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import IconRss from "@/assets/icons/IconRss.svg";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import OrgIcon from "@/components/OrgIcon.astro";
import { SITE } from "@/config";
import { SOCIALS } from "@/constants";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);

const timeline = [
  {
    title: "Senior Machine Learning Engineer",
    subtitle: "Adobe ¬∑ Creative Cloud & Firefly ¬∑ San Jose, CA",
    meta: "2024 ‚Äî Present",
    icon: "adobe" as const,
    description:
      "Leading large-scale data pipelines, training infrastructure, and responsible generative AI initiatives that power Firefly and Creative Cloud surfaces.",
  },
  {
    title: "Software Engineer, Prediction",
    subtitle: "Autonomous Vehicle Systems ¬∑ Bay Area, CA",
    meta: "2022 ‚Äî 2024",
    icon: "zoox" as const,
    description:
      "Shipped multi-agent prediction models for L3/L4/L5 autonomous vehicle fleets and co-designed the training framework and dataloaders that kept the stack fed with fresh data.",
  },
  {
    title: "Senior Systems Engineer",
    subtitle: "Qualcomm Research ¬∑ San Diego, CA",
    meta: "2018 ‚Äî 2022",
    icon: "qualcomm" as const,
    description:
      "Led prediction for Qualcomm's L3 highway autonomous driving stack‚Äîowning forecasting models, simulation harnesses, and post-drive analytics. Earlier built integration and test automation for the stack.",
  },
  {
    title: "Graduated from The Ohio State University",
    subtitle: "Ph.D. Computer Science & Engineering",
    meta: "2018",
    icon: "osu" as const,
    description:
      "Dissertation on collaborative perception and behavior prediction for intelligent transportation systems.",
  },
  {
    title: "Research Intern",
    subtitle: "Microsoft Research ¬∑ Bangalore, India",
    meta: "2016",
    icon: "microsoft" as const,
    description:
      "Designed AutoCalib‚Äîlarge-scale traffic camera calibration with <10% speed error‚Äîin Microsoft's video analytics platform.",
  },
  {
    title: "Graduate Research Assistant",
    subtitle: "The Ohio State University ¬∑ Columbus, OH",
    meta: "2013 ‚Äî 2018",
    icon: "osu" as const,
    description:
      "Built SmartDashCam, Soft-Swipe, RoadView, and RoadMap; taught introductory programming; collaborated with Honda on live calibration and lane-level localization.",
  },
  {
    title: "Software Analyst",
    subtitle: "Standard Chartered Bank ¬∑ Chennai, India",
    meta: "2012 ‚Äî 2013",
    icon: "standard-chartered" as const,
    description:
      "Developed reporting systems and automation scripts for global private banking infrastructure.",
  },
  {
    title: "Project Intern",
    subtitle: "Tata Elxsi ¬∑ Chennai, India",
    meta: "2011",
    icon: "tata-elxsi" as const,
    description:
      "Optimized LTE PDCCH blind decoding algorithms and explored DSP-based radio prototyping.",
  },
  {
    title: "B.Tech Electrical Engineering & Minor in Mathematics",
    subtitle: "Indian Institute of Technology Madras ¬∑ Chennai, India",
    meta: "2008 ‚Äî 2012",
    icon: "iit-madras" as const,
    description:
      "Graduated with honors; led hostel council committees.",
  },
];
---

<Layout>
  <Header />
  <main
    id="main-content"
    data-layout="index"
    class="mx-auto w-full max-w-6xl px-4 pb-20 sm:px-6 lg:px-8"
  >
    <section
      id="hero"
      class="relative overflow-hidden rounded-4xl border border-white/40 bg-white/80 px-6 py-12 shadow-[var(--shadow-xl-soft)] backdrop-blur-xl sm:px-12 sm:py-16 dark:border-slate-700/40 dark:bg-slate-900/70"
    >
      <div class="absolute inset-0 -z-10 bg-gradient-to-br from-accent/20 via-transparent to-transparent opacity-90" />
      <div class="grid gap-10 lg:grid-cols-[minmax(0,1fr)_auto] lg:items-center">
        <div class="max-w-2xl space-y-6">
          <h1 class="text-4xl font-semibold leading-tight sm:text-5xl">
            <span class="bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 bg-clip-text text-transparent">
              Building intelligent systems with clarity.
            </span>
          </h1>
          <p class="text-base leading-relaxed text-secondary-foreground sm:text-lg">
            I'm <span class="bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 bg-clip-text text-transparent font-semibold">Gopi Krishna Tummala</span>. I bridge the gap between Research Papers and Production Systems. Here is my blueprint for modern AI engineering.
          </p>
          <div class="flex flex-wrap gap-3">
            <LinkButton href="/about">About My Work</LinkButton>
            <LinkButton href="/posts" class="border-transparent bg-gradient-to-r from-emerald-600 to-teal-600 text-white shadow-[0_20px_45px_-18px_rgba(16,185,129,0.5)] hover:from-emerald-700 hover:to-teal-700 hover:text-white dark:bg-gradient-to-r dark:from-emerald-500 dark:to-teal-500 dark:text-white dark:hover:from-emerald-600 dark:hover:to-teal-600">
              Browse All Posts
              <IconArrowRight class="inline-block rtl:-rotate-180" />
            </LinkButton>
          </div>
          {
            SOCIALS.length > 0 && (
              <div class="flex w-full max-w-sm flex-col gap-3 rounded-3xl border border-white/40 bg-white/70 p-5 text-sm text-secondary-foreground shadow-sm backdrop-blur-lg dark:border-slate-700/40 dark:bg-slate-900/70">
                <h2 class="text-xs font-semibold uppercase tracking-[0.24em] text-secondary-foreground/80">
                  Connect
                </h2>
                <Socials centered />
              </div>
            )
          }
        </div>
        <div class="mx-auto flex flex-col items-center gap-4">
          <div class="relative">
            <div class="absolute inset-0 -translate-y-2 animate-[pulse_6s_ease-in-out_infinite] rounded-full bg-gradient-to-tr from-emerald-500/20 via-teal-500/25 to-cyan-500/20 blur-2xl" />
            <div class="relative h-48 w-48 overflow-hidden rounded-full border border-white/70 bg-white/60 shadow-[0_40px_90px_-40px_rgba(15,23,42,0.65)] transition hover:shadow-[0_45px_95px_-45px_rgba(56,189,248,0.75)] sm:h-60 sm:w-60 lg:h-64 lg:w-64">
              <img
                src="/gokul.jpg"
                alt="Portrait of Gopi Krishna Tummala"
                class="h-full w-full object-cover object-center"
              />
              <div class="absolute inset-0 rounded-full border border-white/70" />
            </div>
          </div>
          <div class="rounded-full border border-white/30 bg-white/70 px-4 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-secondary-foreground dark:border-slate-700/40 dark:bg-slate-900/70">
            Always learning
          </div>
        </div>
      </div>
    </section>

    <section class="mt-16">
      <h2 class="text-2xl font-semibold text-foreground sm:text-3xl">
        Choose Your Path
      </h2>
      <div class="mt-2 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <p class="max-w-3xl text-sm text-secondary-foreground sm:text-base">
          Structured learning paths organized by domain‚Äîfrom generative AI and production systems to autonomous vehicles and agentic intelligence.
        </p>
        <div class="flex items-center gap-1 rounded-xl border border-white/30 bg-white/70 p-1.5 shadow-sm backdrop-blur-sm dark:border-slate-700/40 dark:bg-slate-900/70">
          <button
            id="view-scroll"
            class="view-option group flex h-9 w-9 items-center justify-center rounded-lg transition-all duration-200"
            aria-label="Scrollable view"
            title="Horizontal scrollable view"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="view-icon">
              <path d="M3 12h18" />
              <path d="M3 6h18" />
              <path d="M3 18h18" />
            </svg>
          </button>
          <button
            id="view-grid"
            class="view-option group flex h-9 w-9 items-center justify-center rounded-lg transition-all duration-200"
            aria-label="Grid view"
            title="Grid layout view"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="view-icon">
              <rect x="3" y="3" width="7" height="7" rx="1" />
              <rect x="14" y="3" width="7" height="7" rx="1" />
              <rect x="3" y="14" width="7" height="7" rx="1" />
              <rect x="14" y="14" width="7" height="7" rx="1" />
            </svg>
          </button>
        </div>
      </div>
      <div class="mt-10 -mx-4 sm:-mx-6 lg:-mx-8">
        <div id="tiles-container" class="overflow-x-auto px-4 sm:px-6 lg:px-8 scroll-smooth" style="scrollbar-width: thin; scrollbar-color: rgba(59, 130, 246, 0.3) transparent;">
          <div id="tiles-wrapper" class="flex gap-6 min-w-max pb-4">
        <a
          href="/learn/gen-ai"
          class="group relative overflow-hidden rounded-3xl border border-white/30 bg-white/70 p-8 text-left shadow-[var(--shadow-xl-soft)] transition hover:-translate-y-1 hover:shadow-[var(--shadow-2xl)] dark:border-slate-700/40 dark:bg-slate-900/70 w-80 flex-shrink-0"
        >
          <div class="mb-4 text-4xl">üß†</div>
          <h3 class="mb-2 text-xl font-semibold text-foreground">
            GenAI Systems
          </h3>
          <p class="text-sm text-secondary-foreground">
            From Transformers to Diffusion Models. Understanding the architectures and algorithms powering modern generative AI.
          </p>
          <div class="mt-4 flex items-center text-sm font-medium text-accent">
            Explore
            <IconArrowRight class="ml-2 inline-block transition-transform group-hover:translate-x-1 rtl:-rotate-180" />
          </div>
        </a>
        <a
          href="/learn/mlops"
          class="group relative overflow-hidden rounded-3xl border border-white/30 bg-white/70 p-8 text-left shadow-[var(--shadow-xl-soft)] transition hover:-translate-y-1 hover:shadow-[var(--shadow-2xl)] dark:border-slate-700/40 dark:bg-slate-900/70 w-80 flex-shrink-0"
        >
          <div class="mb-4 text-4xl">‚öôÔ∏è</div>
          <h3 class="mb-2 text-xl font-semibold text-foreground">
            MLOps & Production
          </h3>
          <p class="text-sm text-secondary-foreground">
            Scaling, serving, and optimizing AI systems. Custom kernels, inference engines, and production infrastructure.
          </p>
          <div class="mt-4 flex items-center text-sm font-medium text-accent">
            Explore
            <IconArrowRight class="ml-2 inline-block transition-transform group-hover:translate-x-1 rtl:-rotate-180" />
          </div>
        </a>
        <a
          href="/learn/robotics"
          class="group relative overflow-hidden rounded-3xl border border-white/30 bg-white/70 p-8 text-left shadow-[var(--shadow-xl-soft)] transition hover:-translate-y-1 hover:shadow-[var(--shadow-2xl)] dark:border-slate-700/40 dark:bg-slate-900/70 w-80 flex-shrink-0"
        >
          <div class="mb-4 text-4xl">üèéÔ∏è</div>
          <h3 class="mb-2 text-xl font-semibold text-foreground">
            Autonomous Systems
          </h3>
          <p class="text-sm text-secondary-foreground">
            How self-driving cars actually work. Prediction, calibration, sensing, and closed-loop reasoning.
          </p>
          <div class="mt-4 flex items-center text-sm font-medium text-accent">
            Explore
            <IconArrowRight class="ml-2 inline-block transition-transform group-hover:translate-x-1 rtl:-rotate-180" />
          </div>
        </a>
        <a
          href="/learn/agentic-ai"
          class="group relative overflow-hidden rounded-3xl border border-white/30 bg-white/70 p-8 text-left shadow-[var(--shadow-xl-soft)] transition hover:-translate-y-1 hover:shadow-[var(--shadow-2xl)] dark:border-slate-700/40 dark:bg-slate-900/70 w-80 flex-shrink-0"
        >
          <div class="mb-4 text-4xl">ü§ñ</div>
          <h3 class="mb-2 text-xl font-semibold text-foreground">
            Agentic AI
          </h3>
          <p class="text-sm text-secondary-foreground">
            From ReAct loops to multi-agent systems. Building intelligent agents that reason, plan, and act autonomously.
          </p>
          <div class="mt-4 flex items-center text-sm font-medium text-accent">
            Explore
            <IconArrowRight class="ml-2 inline-block transition-transform group-hover:translate-x-1 rtl:-rotate-180" />
          </div>
        </a>
          </div>
        </div>
      </div>
    </section>

    <Hr />

    <section class="mt-16">
      <h2 class="text-2xl font-semibold text-foreground sm:text-3xl">
        Journey at a glance
      </h2>
      <p class="mt-2 max-w-3xl text-sm text-secondary-foreground sm:text-base">
        A quick tour through the roles, research labs, and collaborations that shaped my path in AI and autonomous systems.
      </p>
      <div class="relative mt-10 sm:mt-12">
        <div class="absolute left-1/2 top-0 hidden h-full w-px -translate-x-1/2 bg-gradient-to-b from-emerald-500/60 via-teal-500/30 to-transparent sm:block" />
        <ul class="space-y-8 sm:space-y-12">
          {timeline.map((item, index) => {
            const isLeft = index % 2 === 0;
            return (
              <li class="relative">
                <div
                  class:list={[
                    "relative flex gap-4 rounded-3xl border border-white/30 bg-white/70 p-5 text-sm text-secondary-foreground shadow-[var(--shadow-xl-soft)] transition hover:-translate-y-1 dark:border-slate-700/40 dark:bg-slate-900/70 sm:max-w-[43%]",
                    isLeft
                      ? "sm:ml-0 sm:mr-auto sm:flex-row sm:items-center sm:text-left"
                      : "sm:ml-auto sm:mr-0 sm:flex-row-reverse sm:items-center sm:text-right",
                  ]}
                >
                  {item.icon && (
                    <div class="flex h-20 w-20 shrink-0 items-center justify-center rounded-lg border border-white/20 bg-white/50 p-2 dark:border-slate-700/30 dark:bg-slate-800/50">
                      <OrgIcon name={item.icon} size={48} class="opacity-90" />
                    </div>
                  )}
                  <div class="flex-1 flex flex-col gap-2">
                    <span class="text-xs font-semibold uppercase tracking-[0.26em] text-secondary-foreground/70">
                      {item.meta}
                    </span>
                    <h3 class="text-lg font-semibold text-foreground">
                      {item.title}
                    </h3>
                    <p class="text-sm text-secondary-foreground">{item.subtitle}</p>
                    {item.description && (
                      <p class="text-xs text-secondary-foreground/90 sm:text-sm">
                        {item.description}
                      </p>
                    )}
                  </div>
                  <span
                    class="absolute top-1/2 hidden size-3 -translate-y-1/2 rounded-full bg-gradient-to-br from-emerald-500 to-teal-500 shadow-[0_0_0_6px_rgba(16,185,129,0.2)] sm:block"
                    class:list={[
                      isLeft ? "right-[-2.2rem]" : "left-[-2.2rem]",
                    ]}
                  />
                </div>
              </li>
            );
          })}
        </ul>
      </div>
    </section>

    <Hr />

    {
      featuredPosts.length > 0 && (
        <>
          <section id="featured" class="pt-16">
            <h2 class="text-2xl font-semibold tracking-wide text-foreground sm:text-3xl">
              Featured work
            </h2>
            <p class="mt-2 max-w-3xl text-sm text-secondary-foreground sm:text-base">
              A curated selection of recent publications and projects that explore robust perception,
              generative modeling, and multi-agent systems at scale.
            </p>
            <ul class="mt-8 grid gap-6 md:grid-cols-2">
              {featuredPosts.map(data => (
                <Card variant="h3" {...data} />
              ))}
            </ul>
          </section>
          {recentPosts.length > 0 && <Hr />}
        </>
      )
    }

    {
      recentPosts.length > 0 && (
        <section id="recent-posts" class="pt-16">
          <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
            <h2 class="text-2xl font-semibold tracking-wide text-foreground sm:text-3xl">
              Recent writing
            </h2>
            <LinkButton href="/posts">
              View all posts
              <IconArrowRight class="inline-block rtl:-rotate-180" />
            </LinkButton>
          </div>
          <ul class="mt-8 grid gap-6 md:grid-cols-2">
            {recentPosts.map(
              (data, index) =>
                index < SITE.postPerIndex && <Card variant="h3" {...data} />
            )}
          </ul>
        </section>
      )
    }
  </main>
  <Footer />
</Layout>

<style>
  /* Custom scrollbar for webkit browsers */
  .overflow-x-auto::-webkit-scrollbar {
    height: 8px;
  }
  .overflow-x-auto::-webkit-scrollbar-track {
    background: transparent;
  }
  .overflow-x-auto::-webkit-scrollbar-thumb {
    background-color: rgba(59, 130, 246, 0.3);
    border-radius: 4px;
  }
  .overflow-x-auto::-webkit-scrollbar-thumb:hover {
    background-color: rgba(59, 130, 246, 0.5);
  }
  
  /* View toggle button styles */
  .view-option {
    color: rgb(148 163 184);
    position: relative;
  }
  
  .view-option.active {
    background: linear-gradient(135deg, rgb(16 185 129) 0%, rgb(20 184 166) 100%);
    color: white;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.25), 0 0 0 1px rgba(16, 185, 129, 0.1);
    transform: scale(1.05);
  }
  
  .view-option.active .view-icon {
    stroke: white;
    transform: scale(1.1);
  }
  
  .view-option:not(.active):hover {
    color: rgb(16 185 129);
    background: rgba(16, 185, 129, 0.1);
  }
  
  .view-option:not(.active):hover .view-icon {
    stroke: rgb(16 185 129);
    transform: scale(1.05);
  }
  
  .view-icon {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Smooth transition for tiles wrapper */
  #tiles-wrapper {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Stagger animation for grid items */
  #tiles-wrapper.grid > * {
    animation: fadeInUp 0.4s ease-out backwards;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/");
    }

    // View toggle functionality
    const viewScrollBtn = document.getElementById("view-scroll");
    const viewGridBtn = document.getElementById("view-grid");
    const tilesContainer = document.getElementById("tiles-container");
    const tilesWrapper = document.getElementById("tiles-wrapper");
    
    if (viewScrollBtn && viewGridBtn && tilesContainer && tilesWrapper) {
      // Function to set active state
      const setActiveButton = (isGrid: boolean) => {
        if (isGrid) {
          viewGridBtn.classList.add("active");
          viewScrollBtn.classList.remove("active");
        } else {
          viewScrollBtn.classList.add("active");
          viewGridBtn.classList.remove("active");
        }
      };
      
      // Function to switch views
      const switchToView = (isGrid: boolean) => {
        if (isGrid) {
          // Switch to grid view
          tilesContainer.classList.remove("overflow-x-auto");
          tilesContainer.classList.add("overflow-visible");
          tilesWrapper.classList.remove("flex", "min-w-max");
          tilesWrapper.classList.add("grid", "grid-cols-1", "sm:grid-cols-2", "lg:grid-cols-3", "xl:grid-cols-4", "gap-6", "w-full", "min-w-0");
          setActiveButton(true);
          localStorage.setItem("tiles-view", "grid");
        } else {
          // Switch to scrollable view
          tilesContainer.classList.add("overflow-x-auto");
          tilesContainer.classList.remove("overflow-visible");
          tilesWrapper.classList.remove("grid", "grid-cols-1", "sm:grid-cols-2", "lg:grid-cols-3", "xl:grid-cols-4", "gap-6", "w-full", "min-w-0");
          tilesWrapper.classList.add("flex", "min-w-max");
          setActiveButton(false);
          localStorage.setItem("tiles-view", "scroll");
        }
      };
      
      // Check localStorage for saved preference
      const savedView = localStorage.getItem("tiles-view") || "scroll";
      const isGridView = savedView === "grid";
      
      // Initialize view
      switchToView(isGridView);
      
      // Add click handlers
      viewScrollBtn.addEventListener("click", () => switchToView(false));
      viewGridBtn.addEventListener("click", () => switchToView(true));
    }
  });
</script>
