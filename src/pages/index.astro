---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import Socials from "@/components/Socials.astro";
import LinkButton from "@/components/LinkButton.astro";
import Card from "@/components/Card.astro";
import Hr from "@/components/Hr.astro";
import getSortedPosts from "@/utils/getSortedPosts";
import IconRss from "@/assets/icons/IconRss.svg";
import IconArrowRight from "@/assets/icons/IconArrowRight.svg";
import OrgIcon from "@/components/OrgIcon.astro";
import { SITE } from "@/config";
import { SOCIALS } from "@/constants";

const posts = await getCollection("blog");

const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);

const timeline = [
  {
    title: "Senior Machine Learning Engineer",
    subtitle: "Adobe Â· Creative Cloud & Firefly Â· San Jose, CA",
    meta: "2024 â€” Present",
    icon: "adobe" as const,
    description:
      "Leading large-scale data pipelines, training infrastructure, and responsible generative AI initiatives that power Firefly and Creative Cloud surfaces.",
  },
  {
    title: "Software Engineer, Prediction",
    subtitle: "Autonomous Vehicle Systems Â· Bay Area, CA",
    meta: "2022 â€” 2024",
    icon: "zoox" as const,
    description:
      "Shipped multi-agent prediction models for L3/L4/L5 autonomous vehicle fleets and co-designed the training framework and dataloaders that kept the stack fed with fresh data.",
  },
  {
    title: "Senior Systems Engineer",
    subtitle: "Qualcomm Research Â· San Diego, CA",
    meta: "2018 â€” 2022",
    icon: "qualcomm" as const,
    description:
      "Led prediction for Qualcomm's L3 highway autonomous driving stackâ€”owning forecasting models, simulation harnesses, and post-drive analytics. Earlier built integration and test automation for the stack.",
  },
  {
    title: "Graduated from The Ohio State University",
    subtitle: "Ph.D. Computer Science & Engineering",
    meta: "2018",
    icon: "osu" as const,
    description:
      "Dissertation on collaborative perception and behavior prediction for intelligent transportation systems.",
  },
  {
    title: "Research Intern",
    subtitle: "Microsoft Research Â· Bangalore, India",
    meta: "2016",
    icon: "microsoft" as const,
    description:
      "Designed AutoCalibâ€”large-scale traffic camera calibration with <10% speed errorâ€”in Microsoft's video analytics platform.",
  },
  {
    title: "Graduate Research Assistant",
    subtitle: "The Ohio State University Â· Columbus, OH",
    meta: "2013 â€” 2018",
    icon: "osu" as const,
    description:
      "Built SmartDashCam, Soft-Swipe, RoadView, and RoadMap; taught introductory programming; collaborated with Honda on live calibration and lane-level localization.",
  },
  {
    title: "Software Analyst",
    subtitle: "Standard Chartered Bank Â· Chennai, India",
    meta: "2012 â€” 2013",
    icon: "standard-chartered" as const,
    description:
      "Developed reporting systems and automation scripts for global private banking infrastructure.",
  },
  {
    title: "Project Intern",
    subtitle: "Tata Elxsi Â· Chennai, India",
    meta: "2011",
    icon: "tata-elxsi" as const,
    description:
      "Optimized LTE PDCCH blind decoding algorithms and explored DSP-based radio prototyping.",
  },
  {
    title: "B.Tech Electrical Engineering & Minor in Mathematics",
    subtitle: "Indian Institute of Technology Madras Â· Chennai, India",
    meta: "2008 â€” 2012",
    icon: "iit-madras" as const,
    description:
      "Graduated with honors; led hostel council committees.",
  },
];
---

<Layout>
  <Header />
  <main
    id="main-content"
    data-layout="index"
    class="mx-auto w-full max-w-6xl px-4 pb-20 sm:px-6 lg:px-8"
  >
    <section
      id="hero"
      class="relative overflow-hidden rounded-[2.5rem] border border-white/20 bg-white/40 p-8 shadow-2xl backdrop-blur-3xl sm:p-12 lg:p-16 dark:border-white/10 dark:bg-slate-900/40"
    >
      <div class="absolute -top-24 -right-24 h-96 w-96 rounded-full bg-accent/10 blur-[100px] pointer-events-none" />
      <div class="absolute -bottom-24 -left-24 h-96 w-96 rounded-full bg-cyan-500/10 blur-[100px] pointer-events-none" />
      
      <div class="grid gap-12 lg:grid-cols-[1fr_auto] lg:items-center">
        <div class="max-w-2xl space-y-8 reveal visible">
          <div class="inline-flex items-center gap-2 rounded-full border border-accent/20 bg-accent/5 px-4 py-1.5 text-xs font-bold uppercase tracking-widest text-accent">
            <span class="relative flex h-2 w-2">
              <span class="absolute inline-flex h-full w-full animate-ping rounded-full bg-accent opacity-75"></span>
              <span class="relative inline-flex h-2 w-2 rounded-full bg-accent"></span>
            </span>
            Available for collaborations
          </div>
          
          <h1 class="text-4xl font-extrabold leading-[1.1] sm:text-6xl tracking-tight">
            <span class="block text-foreground mb-2">Architecting</span>
            <span class="bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 bg-clip-text text-transparent italic">
              Future Intelligence.
            </span>
          </h1>
          
          <p class="text-lg leading-relaxed text-secondary-foreground/90 sm:text-xl max-w-xl">
            Senior ML Engineer at <span class="text-foreground font-bold">Adobe Firefly</span>. 
            Ph.D. in Computer Vision. Bridging the gap between 
            <span class="text-accent font-medium">Deep Research</span> and <span class="text-accent font-medium">Production Systems</span>.
          </p>
          
          <div class="flex flex-wrap gap-4 pt-4">
            <LinkButton href="/about" class="btn-tech">About My Work</LinkButton>
            <LinkButton href="/posts" class="group flex items-center gap-2 px-6 py-2.5 rounded-xl border border-border bg-background/50 hover:bg-background transition-all">
              Browse All Posts
              <IconArrowRight class="transition-transform group-hover:translate-x-1" />
            </LinkButton>
          </div>
          
          {
            SOCIALS.length > 0 && (
              <div class="pt-8 flex flex-col gap-4">
                <div class="flex items-center gap-4">
                  <div class="h-px flex-1 bg-border/50" />
                  <span class="text-[10px] font-bold uppercase tracking-[0.3em] text-secondary-foreground/50">Connect</span>
                  <div class="h-px flex-1 bg-border/50" />
                </div>
                <Socials centered />
              </div>
            )
          }
        </div>
        
        <div class="mx-auto flex flex-col items-center gap-6 reveal visible delay-200">
          <div class="relative group">
            <div class="absolute inset-0 rounded-full bg-gradient-to-tr from-accent/40 via-cyan-500/40 to-emerald-500/40 blur-2xl opacity-50 group-hover:opacity-100 transition-opacity duration-500" />
            <div class="relative h-56 w-56 overflow-hidden rounded-full border-4 border-white/20 bg-slate-800 shadow-2xl transition-transform duration-500 group-hover:scale-105 sm:h-72 sm:w-72">
              <img
                src="/gokul.jpg"
                alt="Gopi Krishna Tummala"
                class="h-full w-full object-cover object-center grayscale hover:grayscale-0 transition-all duration-700"
              />
            </div>
            <div class="absolute -bottom-4 left-1/2 -translate-x-1/2 bg-background/80 backdrop-blur-md border border-border px-6 py-2 rounded-full shadow-lg whitespace-nowrap">
              <span class="text-sm font-bold tracking-tight text-foreground italic">Gopi Krishna Tummala</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="mt-24 reveal">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between mb-12">
        <div>
          <h2 class="text-3xl font-bold text-foreground">
            Choose Your Path
          </h2>
          <p class="mt-2 max-w-2xl text-secondary-foreground/80">
            Structured learning modules curated for practitioners and researchers.
          </p>
        </div>
        
        <div class="flex items-center gap-1 rounded-2xl border border-border bg-element/50 p-1 backdrop-blur-sm">
          <button id="view-scroll" class="view-option p-2 rounded-xl transition-all" aria-label="Scroll view">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
          </button>
          <button id="view-grid" class="view-option p-2 rounded-xl transition-all" aria-label="Grid view">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          </button>
        </div>
      </div>

      <div id="tiles-container" class="overflow-x-auto pb-8 -mx-4 px-4 sm:-mx-6 sm:px-6 lg:-mx-8 lg:px-8">
        <div id="tiles-wrapper" class="flex gap-8 min-w-max">
          {[
            { id: "gen-ai", emoji: "ðŸ§ ", title: "GenAI Systems", desc: "Transformers, Diffusion, and large-scale training." },
            { id: "mlops", emoji: "âš™ï¸", title: "MLOps & Scale", desc: "Production infrastructure and inference optimization." },
            { id: "robotics", emoji: "ðŸŽï¸", title: "Robotics", desc: "Autonomous stack: from perception to planning." },
            { id: "agentic-ai", emoji: "ðŸ¤–", title: "Agentic AI", desc: "Reasoning loops and multi-agent orchestration." }
          ].map(path => (
            <a href={`/learn/${path.id}`} class="glass-card group w-80 p-8 rounded-[2rem] flex-shrink-0 flex flex-col gap-4">
              <div class="text-5xl group-hover:scale-110 transition-transform duration-500">{path.emoji}</div>
              <h3 class="text-2xl font-bold text-foreground group-hover:text-accent transition-colors">{path.title}</h3>
              <p class="text-sm text-secondary-foreground leading-relaxed flex-1">{path.desc}</p>
              <div class="flex items-center gap-2 text-accent font-bold text-xs uppercase tracking-widest mt-4">
                Explore <IconArrowRight class="w-4 h-4" />
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>

    <section class="mt-32 reveal">
      <div class="text-center mb-16">
        <h2 class="text-3xl font-bold text-foreground sm:text-4xl">Career Timeline</h2>
        <div class="mt-4 flex justify-center">
          <div class="h-1.5 w-24 rounded-full bg-gradient-to-r from-emerald-500 to-teal-500" />
        </div>
      </div>
      
      <div class="relative space-y-12">
        <div class="absolute left-1/2 top-0 h-full w-px -translate-x-1/2 bg-border/50 hidden sm:block" />
        
        {timeline.map((item, index) => (
          <div class={`relative flex flex-col sm:flex-row items-center gap-8 ${index % 2 === 0 ? 'sm:flex-row' : 'sm:flex-row-reverse text-center sm:text-right'}`}>
            <div class="flex-1 w-full sm:w-auto">
              <div class="glass-card p-6 rounded-3xl hover:border-accent/30 transition-all">
                <span class="text-xs font-bold text-accent uppercase tracking-widest">{item.meta}</span>
                <h3 class="text-xl font-bold text-foreground mt-2">{item.title}</h3>
                <p class="text-sm font-medium text-secondary-foreground mb-4">{item.subtitle}</p>
                <p class="text-sm text-secondary-foreground/80 leading-relaxed italic">{item.description}</p>
              </div>
            </div>
            
            <div class="relative z-10 flex h-16 w-16 shrink-0 items-center justify-center rounded-2xl bg-background border-2 border-accent shadow-xl">
              <OrgIcon name={item.icon} size={32} />
            </div>
            
            <div class="flex-1 hidden sm:block" />
          </div>
        ))}
      </div>
    </section>

    <Hr class="my-32" />

    {featuredPosts.length > 0 && (
      <section id="featured" class="reveal">
        <div class="flex items-end justify-between mb-12">
          <h2 class="text-3xl font-bold text-foreground">Featured Writing</h2>
          <LinkButton href="/posts" class="text-accent font-bold hover:underline">See all &rarr;</LinkButton>
        </div>
        <ul class="grid gap-8 md:grid-cols-2">
          {featuredPosts.map(data => <Card variant="h3" {...data} />)}
        </ul>
      </section>
    )}
  </main>
  <Footer />
</Layout>

<style>
  @reference "../styles/global.css";
  
  .view-option.active {
    @apply bg-accent text-white shadow-lg;
  }
  
  /* Reveal on scroll observer will handle this */
  .reveal {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
  }
  
  .reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  document.addEventListener("astro:page-load", () => {
    // Reveal Observer
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

    // View toggle functionality
    const viewScrollBtn = document.getElementById("view-scroll");
    const viewGridBtn = document.getElementById("view-grid");
    const tilesContainer = document.getElementById("tiles-container");
    const tilesWrapper = document.getElementById("tiles-wrapper");
    
    if (viewScrollBtn && viewGridBtn && tilesContainer && tilesWrapper) {
      const updateView = (isGrid: boolean) => {
        if (isGrid) {
          tilesContainer.classList.remove("overflow-x-auto");
          tilesWrapper.classList.remove("flex", "min-w-max");
          tilesWrapper.classList.add("grid", "grid-cols-1", "sm:grid-cols-2", "lg:grid-cols-4", "gap-8", "w-full");
          viewGridBtn.classList.add("active");
          viewScrollBtn.classList.remove("active");
        } else {
          tilesContainer.classList.add("overflow-x-auto");
          tilesWrapper.classList.add("flex", "min-w-max");
          tilesWrapper.classList.remove("grid", "grid-cols-1", "sm:grid-cols-2", "lg:grid-cols-4", "gap-8", "w-full");
          viewScrollBtn.classList.add("active");
          viewGridBtn.classList.remove("active");
        }
        localStorage.setItem("tiles-view", isGrid ? "grid" : "scroll");
      };

      const savedView = localStorage.getItem("tiles-view") || "scroll";
      updateView(savedView === "grid");

      viewScrollBtn.addEventListener("click", () => updateView(false));
      viewGridBtn.addEventListener("click", () => updateView(true));
    }
  });
</script>
